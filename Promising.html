<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Skill Progress and Test</title>
<style>
  body { font-family: Arial, sans-serif; margin: 20px; background: #f9f9f9; }
  #skillsGrid { display: flex; gap: 15px; flex-wrap: wrap; }
  .skill-card {
    background: white; border-radius: 10px; box-shadow: 0 2px 5px #ccc; padding: 15px; width: 220px;
    cursor: pointer; user-select: none; transition: box-shadow 0.3s ease;
  }
  .skill-card:hover { box-shadow: 0 6px 12px #bbb; }
  .skill-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px; }
  .skill-name { font-weight: bold; font-size: 1.1rem; }
  .skill-level { font-weight: 600; color: #3182ce; }
  .skill-exp-bar { background: #e2e8f0; border-radius: 10px; height: 15px; overflow: hidden; margin-top: 4px; }
  .skill-exp-fill { background: #3182ce; height: 100%; width: 0%; transition: width 0.5s ease; }
  .locked { opacity: 0.6; cursor: not-allowed; }
  .lock-icon { font-size: 18px; color: #a0aec0; }

  #skillDetail { display: none; max-width: 600px; background: white; padding: 20px; border-radius: 12px; box-shadow: 0 2px 10px #ccc; margin-top: 20px; }
  #skillItems .skill-item { margin-bottom: 12px; }
  .skill-item-header { display: flex; justify-content: space-between; font-weight: 600; margin-bottom: 4px; }
  .skill-item-name { color: #2d3748; }
  .skill-item-exp { color: #38a169; }

  #testButtonContainer { margin-top: 15px; }
  #testButtonContainer button {
    background-color: #38a169; border: none; color: white; padding: 10px 18px;
    border-radius: 8px; font-weight: 600; cursor: pointer; font-size: 1rem;
    transition: background-color 0.3s ease;
  }
  #testButtonContainer button:hover { background-color: #2f855a; }

  /* Modal styles */
  #testModal {
    display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100vw; height: 100vh;
    background: rgba(0,0,0,0.4); backdrop-filter: blur(3px);
    justify-content: center; align-items: center;
  }
  #testModalContent {
    background: white; border-radius: 12px; max-width: 400px; width: 90%;
    padding: 20px; box-shadow: 0 2px 10px #00000033; position: relative;
  }
  #testModalContent h3 { margin-top: 0; }
  #testItemsContainer { max-height: 300px; overflow-y: auto; margin-bottom: 15px; }
  .test-item { margin-bottom: 10px; }
  #testModalContent button {
    background-color: #3182ce; border: none; color: white; padding: 10px 16px;
    border-radius: 8px; cursor: pointer; font-weight: 600; margin-right: 10px;
  }
  #testModalContent button:hover { background-color: #2c5282; }
  #closeTestModalBtn {
    position: absolute; right: 15px; top: 15px; font-size: 18px; font-weight: bold;
    cursor: pointer; color: #555;
  }

  #backToMainBtn {
    margin-top: 20px; padding: 10px 18px; border-radius: 8px; border: none;
    background-color: #718096; color: white; cursor: pointer; font-weight: 600;
  }
  #backToMainBtn:hover { background-color: #4a5568; }

  .completed-locked-label {
    font-style: italic; color: #38a169; margin-left: 8px; font-weight: 600;
  }
</style>
</head>
<body>

<h1>Skill Progress Tracker</h1>

<div id="mainPage">
  <div id="skillsGrid"></div>
</div>

<div id="skillDetail">
  <button id="backToMainBtn">‚Üê Back to Skills</button>
  <h2 id="detailSkillName"></h2>
  <div><strong>Level:</strong> <span id="detailSkillLevel"></span></div>
  <div style="margin:10px 0;">
    <div style="font-weight:600;">Experience Progress:</div>
    <div style="background:#e2e8f0; border-radius: 12px; height: 20px; width: 100%; overflow: hidden;">
      <div id="detailSkillExpFill" style="background:#3182ce; height: 100%; width: 0%; transition: width 0.5s;"></div>
    </div>
    <div style="margin-top: 4px;">
      <span id="detailSkillExp"></span> / <span id="detailSkillExpNeeded"></span> EXP
    </div>
  </div>

  <div id="skillItems"></div>

  <div id="testButtonContainer"></div>
</div>

<!-- Test Modal -->
<div id="testModal">
  <div id="testModalContent">
    <span id="closeTestModalBtn" title="Close">&times;</span>
    <h3>Skill Test - Recheck all completed items</h3>
    <div id="testItemsContainer"></div>
    <button id="submitTestBtn">Submit Test</button>
  </div>
</div>

<script>
  // Initial skills data sample (you can customize)
  const skillsData = {
    "Programming": {
      level: 1,
      totalExp: 80,
      items: [
        { name: "Learn JavaScript", exp: 30, completed: true },
        { name: "Understand HTML", exp: 25, completed: true },
        { name: "CSS Basics", exp: 25, completed: false }
      ],
      lockedAfterTest: false
    },
    "Design": {
      level: 0,
      totalExp: 0,
      items: [
        { name: "Color Theory", exp: 40, completed: false },
        { name: "UI/UX Principles", exp: 60, completed: false }
      ],
      lockedAfterTest: false
    }
  };

  // Simulated username for localStorage (single user demo)
  const username = 'defaultUser';

  // Load saved data or initialize
  const allHotelData = JSON.parse(localStorage.getItem('hotelSkillsData') || '{}');
  if(allHotelData[username]) {
    Object.assign(skillsData, allHotelData[username]);
  }

  // Exp needed to level up function (simple: 100 per level)
  function getExpNeeded(level) {
    return 100;
  }

  // Calculate level from totalExp
  function calculateLevelFromExp(exp) {
    return Math.floor(exp / 100);
  }

  // Get exp progress within current level (remainder)
  function getCurrentLevelExp(exp, level) {
    return exp - (level * 100);
  }

  // Calculate total level from all skills
  function calculateTotalLevel() {
    let total = 0;
    for (const s in skillsData) {
      total += skillsData[s].level;
    }
    return total;
  }

  // Check if skill is max level (let's say max level 3 for demo)
  function isSkillMaxLevel(skillName) {
    return skillsData[skillName].level >= 3;
  }

  // Show main skills grid
  function renderSkillsGrid() {
    const grid = document.getElementById('skillsGrid');
    grid.innerHTML = '';

    Object.keys(skillsData).forEach(skillName => {
      const skill = skillsData[skillName];
      const card = document.createElement('div');
      card.className = `skill-card ${skill.lockedAfterTest ? 'locked' : ''}`;

      const expNeeded = getExpNeeded(skill.level);
      const currentLevelExp = getCurrentLevelExp(skill.totalExp, skill.level);
      const expProgress = (skill.level > 0 || currentLevelExp > 0) ? (currentLevelExp / expNeeded) * 100 : 0;
      const isMaxLevel = isSkillMaxLevel(skillName);

      let expSection = '';

      if (skill.lockedAfterTest) {
        expSection = '<div class="lock-icon">üîí Locked (Passed Test)</div>';
      } else if (isMaxLevel) {
        expSection = '<div style="color: #48bb78; font-weight: bold; text-align: center;">üèÜ MAX LEVEL üèÜ</div>';
      } else {
        expSection = `
          <div>Experience: ${currentLevelExp} / ${expNeeded}</div>
          <div class="skill-exp-bar">
            <div class="skill-exp-fill" style="width: ${expProgress}%"></div>
          </div>
        `;
      }

      card.innerHTML = `
        <div class="skill-header">
          <h3 class="skill-name">${skillName}</h3>
          <div class="skill-level">${isMaxLevel ? 'MAX LEVEL' : 'Level ' + skill.level}</div>
        </div>
        <div class="skill-exp">${expSection}</div>
      `;

      if (!skill.lockedAfterTest) {
        card.onclick = () => showSkillDetail(skillName);
      }

      grid.appendChild(card);
    });
  }

  // Show detail of one skill
  function showSkillDetail(skillName) {
    const skill = skillsData[skillName];
    document.getElementById('mainPage').style.display = 'none';
    document.getElementById('skillDetail').style.display = 'block';

    const isMaxLevel = isSkillMaxLevel(skillName);
    const expNeeded = getExpNeeded(skill.level);
    const currentLevelExp = getCurrentLevelExp(skill.totalExp, skill.level);

    document.getElementById('detailSkillName').textContent = skillName;
    document.getElementById('detailSkillLevel').textContent = isMaxLevel ? 'MAX LEVEL' : 'Level ' + skill.level;
    document.getElementById('detailSkillExp').textContent = currentLevelExp;
    document.getElementById('detailSkillExpNeeded').textContent = expNeeded;

    const expProgress = (skill.level > 0 || currentLevelExp > 0) ? (currentLevelExp / expNeeded) * 100 : 0;
    document.getElementById('detailSkillExpFill').style.width = expProgress + '%';

    const itemsContainer = document.getElementById('skillItems');
    itemsContainer.innerHTML = '';

    if (isMaxLevel) {
      const maxDiv = document.createElement('div');
      maxDiv.style.textAlign = 'center';
      maxDiv.style.padding = '30px';
      maxDiv.style.background = 'linear-gradient(135deg, #48bb78, #38a169)';
      maxDiv.style.color = 'white';
      maxDiv.style.borderRadius = '15px';
      maxDiv.style.fontSize = '1.2rem';
      maxDiv.textContent = 'üèÜ CONGRATULATIONS! You have reached MAX LEVEL!';
      itemsContainer.appendChild(maxDiv);
    }

    skill.items.forEach((item, index) => {
      const itemDiv = document.createElement('div');
      itemDiv.className = 'skill-item';

      const disabled = skill.lockedAfterTest ? 'disabled' : '';
      itemDiv.innerHTML = `
        <div class="skill-item-header">
          <span class="skill-item-name">${item.name}</span>
          <span class="skill-item-exp">+${item.exp} EXP</span>
        </div>
        <label>
          <input type="checkbox" class="skill-checkbox" ${item.completed ? 'checked' : ''} ${disabled} data-index="${index}">
          ${item.completed && skill.lockedAfterTest ? 
            `<span class="completed-locked-label">(Completed - Locked)</span>` : 
            item.completed ? '(Completed - Click to unselect)' : 'Mark as completed'}
        </label>
      `;
      itemsContainer.appendChild(itemDiv);
    });

    // Add event listeners to checkboxes (only if not locked)
    if (!skill.lockedAfterTest) {
      document.querySelectorAll('#skillItems input.skill-checkbox').forEach(cb => {
        cb.onchange = () => toggleSkillItem(skillName, Number(cb.dataset.index));
      });
    }

    // Show "Take Test" button if skill progress full, NOT locked, NOT max level
    const testButtonContainer = document.getElementById('testButtonContainer');
    testButtonContainer.innerHTML = '';

    if (!skill.lockedAfterTest && !isMaxLevel && currentLevelExp >= expNeeded) {
      const btn = document.createElement('button');
      btn.textContent = 'Take Test to Level Up';
      btn.onclick = () => showTestModal(skillName);
      testButtonContainer.appendChild(btn);
    }
  }

  // Toggle skill item checkbox
  function toggleSkillItem(skillName, itemIndex) {
    const skill = skillsData[skillName];
    if (skill.lockedAfterTest) {
      alert('This skill is locked after passing the test. You cannot change items anymore.');
      showSkillDetail(skillName); // reset UI state
      return;
    }
    const item = skill.items[itemIndex];
    if (item.completed) {
      // unselect - remove exp
      item.completed = false;
      skill.totalExp = Math.max(0, skill.totalExp - item.exp);
    } else {
      // select - add exp
      item.completed = true;
      skill.totalExp += item.exp;
    }

    // Recalculate level
    const newLevel = calculateLevelFromExp(skill.totalExp);
    skill.level = newLevel;

    // Save updated data
    allHotelData[username] = skillsData;
    localStorage.setItem('hotelSkillsData', JSON.stringify(allHotelData));

    showSkillDetail(skillName);
    renderSkillsGrid();
  }

  // Show the test modal and fill with completed items
  function showTestModal(skillName) {
    const modal = document.getElementById('testModal');
    modal.style.display = 'flex';

    const skill = skillsData[skillName];
    const container = document.getElementById('testItemsContainer');
    container.innerHTML = '';

    skill.items.forEach((item, index) => {
      if (item.completed) {
        const div = document.createElement('div');
        div.className = 'test-item';
        div.innerHTML = `
          <label>
            <input type="checkbox" class="test-checkbox" data-index="${index}">
            ${item.name}
          </label>
        `;
        container.appendChild(div);
      }
    });

    modal.dataset.skillName = skillName;
  }

  // Close test modal
  function closeTestModal() {
    const modal = document.getElementById('testModal');
    modal.style.display = 'none';
  }

  // Submit test: validate all checkboxes checked
  function submitTest() {
    const modal = document.getElementById('testModal');
    const skillName = modal.dataset.skillName;
    const skill = skillsData[skillName];

    const checkboxes = modal.querySelectorAll('.test-checkbox');
    let allChecked = true;
    checkboxes.forEach(cb => {
      if (!cb.checked) allChecked = false;
    });

    if (!allChecked) {
      alert('Please re-check all items to pass the test.');
      return;
    }

    // Passed test: lock skill, level up if not max
    skill.lockedAfterTest = true;

    // Level up by one level if not max yet
    if (!isSkillMaxLevel(skillName)) {
      skill.totalExp = (skill.level + 1) * 100;
      skill.level = calculateLevelFromExp(skill.totalExp);
    }

    allHotelData[username] = skillsData;
    localStorage.setItem('hotelSkillsData', JSON.stringify(allHotelData));

    alert(`Congrats! You passed the test and leveled up "${skillName}"! This skill is now locked.`);

    closeTestModal();
    showSkillDetail(skillName);
    renderSkillsGrid();
  }

  // Event listeners for modal buttons
  document.getElementById('closeTestModalBtn').onclick = closeTestModal;
  document.getElementById('submitTestBtn').onclick = submitTest;
  document.getElementById('backToMainBtn').onclick = () => {
    document.getElementById('skillDetail').style.display = 'none';
    document.getElementById('mainPage').style.display = 'block';
    renderSkillsGrid();
  };

  // Initial render
  renderSkillsGrid();

</script>
</body>
</html>
